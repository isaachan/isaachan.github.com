
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Chocolatey, 我爱你 - To iterate is human, to recurse divine.</title>
  <meta name="author" content="">

  
  <meta name="description" content="巧克力在很多文化里都代表了美好的事物。如果你是Windows的使用者，可能Windows复杂、丑陋的包管理正在把你折腾的很惨。*NIX平台上的各种优雅的包管理工具这时让人非常眼馋。直到有一天Chocolatey出现了，让我看到了Windows平台上的包管理朝着正确的方向前进了。看来， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://isaachan.github.com/blog/2013/02/07/chocolatey-i-love-you">
  <link href="/favicon.ico" rel="icon">
  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="To iterate is human, to recurse divine." type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42344616-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="no-sidebar"  >
  <header role="banner"><hgroup>
  <h1>To iterate is human, to recurse divine.</h1>
  
    <h2><a href="/">金皆</a></h2>
  
</hgroup>

</header>
  <nav role="navigation">
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:isaachan.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Chocolatey, 我爱你</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-07T14:28:00+08:00" pubdate data-updated="true">Feb 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>巧克力在很多文化里都代表了美好的事物。如果你是Windows的使用者，可能Windows复杂、丑陋的包管理正在把你折腾的很惨。*NIX平台上的各种优雅的包管理工具这时让人非常眼馋。直到有一天Chocolatey出现了，让我看到了Windows平台上的包管理朝着正确的方向前进了。看来，和巧克力沾边的东西都能让人产生幸福的感觉。</p>

<h2>1. 安装</h2>

<p>Chocolatey的安装过程简单至极，在<a href="http://chocolatey.org/">Chocolatey.org</a>上最醒目的地方有一行命令，把它复制到命令行中运行，只要一分钟左右，安装就完成了。在命令下键入</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">chocolatey</span> <span class="n">help</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以验证安装是否成功。</p>

<!-- more -->


<h2>2. 初体验</h2>

<p>默认情况下，Chocolatey会把自己安装到C:\Chocolatey目录下。该目录下还有三个子目录，它们的作用分别是</p>

<ul>
<li>bin - Chocolatey自身的命令，以及通过Chocolatey安装的某些软件会在bin下增加一个*.bat的快捷方法。</li>
<li>chocolateyInstall - Chocolatey运行时的程序以及各种log。</li>
<li>lib - 安装过程中下载的包。</li>
</ul>


<p>是时候尝试一下Chocolatey的威力了，在命令行上键入</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">chocolatey</span> <span class="n">install</span> <span class="n">7zip</span>
</span></code></pre></td></tr></table></div></figure>


<p>此时会出现下载的进度信息。耐心等一会儿，Chocolatey会告诉你安装完成。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>“Finished installing '7zip' and dependencies - if errors not shown in console, none detected. Check log for errors if unsure”</span></code></pre></td></tr></table></div></figure>


<p>这之后检查你的Program Files(或者Program Files (x86))下应该包含7-Zip目录了。</p>

<h2>3. 安装自己的包</h2>

<p>在我写这篇博客的时候，我的机器上并没有中文输入法。在Chocolatey上寻找未果后（<a href="http://chocolatey.org/packages?q=google+pinyin">http://chocolatey.org/packages?q=google+pinyin</a>）（在你读到这篇Blog的时候，我已经上传了Google Pinyin的安装包），我只能自己为Google Pinyin创建一个Chocolatey的安装包。研究过C:\Chocolatey\lib\下面的7Zip的包文件后，我们可以获知创建Chocolatey包的方法。</p>

<p>Chocoletay包一个满足特定目录结构的NuGet包。<a href="http://nuget.org/">NuGet</a>是另一个Windows上令人心动的工具，它是一种特定的包格式，类似于.deb .rpm，同时它也具有版本化的包管理功能。与Chocolatey的不同在于，NuGet关注在开发人员使用的包，而Chocoletay更关注最终用户可用的软件包。既然Chocolatey包就是NuGet包，可以用命令</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">NuGet</span><span class="p">.</span><span class="n">exe</span> <span class="n">pack</span> <span class="p">****.</span><span class="n">nuspec</span>
</span></code></pre></td></tr></table></div></figure>


<p>创建。如果你没有安装NuGet没有关系，Chocolatey包含了一个NuGet的二进制执行文件，可以使用命令</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">cpack</span><span class="p">.</span><span class="n">bat</span> <span class="n">pack</span> <span class="p">****.</span><span class="n">nuspec</span>
</span></code></pre></td></tr></table></div></figure>


<p>创建。cpack.bat可在C:\Chocolatey\bin目录下找到。</p>

<p>不过Chocolatey的包还需要一些特殊的内容，才能被Chocolatey识别并安装。查看7Zip的安装文件后，可以看到我们需要在包的顶级目录下创建一个tools目录，并在下面包含一个chocolateyInstall.ps1文件，该文件是安装包的（PowerShell）代码。 综上所述，我们需要很少的步骤，就能创建Google Pinyin的包：</p>

<p>&#8212; C:/GooglePinyinPackage/google-pinyin.nuspec &#8212;</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;package&gt;</span>
</span><span class='line'>    <span class="nt">&lt;metadata&gt;</span>
</span><span class='line'>        <span class="nt">&lt;id&gt;</span>google-pinyin<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>Google Pinyin<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;authors&gt;</span>Han Kai<span class="nt">&lt;/authors&gt;</span>
</span><span class='line'>        <span class="nt">&lt;owners&gt;</span>Han Kai<span class="nt">&lt;/owners&gt;</span>
</span><span class='line'>        <span class="nt">&lt;requireLicenseAcceptance&gt;</span>false<span class="nt">&lt;/requireLicenseAcceptance&gt;</span>
</span><span class='line'>        <span class="nt">&lt;description&gt;</span>Google pinyin installation for Chinese requirement.<span class="nt">&lt;/description&gt;</span>
</span><span class='line'>        <span class="nt">&lt;copyright&gt;</span>Copyright 2012<span class="nt">&lt;/copyright&gt;</span>
</span><span class='line'>        <span class="nt">&lt;tags&gt;</span>google pinyin<span class="nt">&lt;/tags&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/metadata&gt;</span>
</span><span class='line'>    <span class="nt">&lt;files&gt;</span>
</span><span class='line'>        <span class="nt">&lt;file</span> <span class="na">src=</span><span class="s">&quot;chocolateyInstall.ps1&quot;</span> <span class="na">target=</span><span class="s">&quot;tools/chocolateyInstall.ps1&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/files&gt;</span>
</span><span class='line'><span class="nt">&lt;/package&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>以及
&#8212; C:/GooglePinyinPackage/chocolateyInstall.ps1 &#8212;</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="k">try</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">Install-ChocolateyPackage</span> <span class="s1">&#39;google-pinyin&#39;</span> <span class="s1">&#39;exe&#39;</span> <span class="s1">&#39;/s&#39;</span> <span class="s1">&#39;http://dl.google.com/pinyin/v2/GooglePinyinInstaller.exe&#39;</span>
</span><span class='line'><span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">Write-ChocolateyFailure</span> <span class="s1">&#39;Google Pinyin&#39;</span> <span class="s2">&quot;</span><span class="si">$(</span><span class="err">$</span><span class="si">_.Exception.Message)</span><span class="s2">&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>此处使用了Chocolatey提供的Install-ChocolateyPackage函数，它需要四个参数，id（google-pinyin，这个要和google-pinyin.nuspec中的一致），安装文件类型，安装参数（/s是silent installation）和安装文件的下载路径。</p>

<p>这时在C:\google-pinyin目录下运行下面的命令，可以生成google-pinyin.nupack包：</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">cpack</span> <span class="n">google-pinyin</span><span class="p">.</span><span class="n">nuspec</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行下面的命令可以安装这个包，</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='powershell'><span class='line'><span class="n">cinst</span> <span class="n">googe-pinyin</span> <span class="n">-source</span> <span class="n">C</span><span class="err">:</span><span class="p">\</span><span class="n">GooglePinyinPackage</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中，cinst是chocolatey install的快捷方式。<strong>-source C:\GooglePinyinPackage</strong>非常重要，它将本地C:\GooglePinyinPackage目录设置为cinst的安装软件包源。如果没有这个参数，cinst会在默认的两个源中查找，而后抱怨找不到google-pinyin。cinst的两个默认源是<a href="http://chocolatey.org/api/v2/">这里</a>和<a href="http://chocolatey.org/api/v2/">这里</a>。</p>

<p>现在，安装应该结束了，可以看一看你的输入法列表中是否包含了Google拼音输入法。</p>

<h2>4. 分享你的安装包</h2>

<p>到目前为止，我们安装了两个包，7Zip和Google拼音输入法，一个来自于Chocolatey.org，一个是我自己创建的。Chocolatey.org实际上是个社区，鼓励大家分享不同人创建的安装包。这正是我钟爱Chocolatey的原因！那么，接下来我要把刚刚创建的安装包发布到Chocolatey社区中。</p>

<p>发布安装包需要注册Chocolatey账户。注册完成后，可以在<a href="http://chocolatey.org/packages/upload">这里</a>上传安装包。</p>

<p><img src="/images/upload-chocolatey-package.png" alt="上传Chocolatey安装包" /></p>
</div>


  <footer>
    <p class="meta">
      
  



      








  


<time datetime="2013-02-07T14:28:00+08:00" pubdate data-updated="true">Feb 7<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/chocolatey/'>chocolatey</a>, <a class='category' href='/blog/categories/devops/'>devops</a>, <a class='category' href='/blog/categories/powershell/'>powershell</a>, <a class='category' href='/blog/categories/windows-automation/'>windows automation</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/31/about-ideal/" title="Previous Post: 关于理想">&laquo; 关于理想</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/08/17/slide-textuality/" title="next Post: 幻灯片文本化">幻灯片文本化 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'isaachan';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://isaachan.github.com/blog/2013/02/07/chocolatey-i-love-you/';
        var disqus_url = 'http://isaachan.github.com/blog/2013/02/07/chocolatey-i-love-you/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
